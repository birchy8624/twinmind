'use client'

import Link from 'next/link'
import type { Route } from 'next'
import { usePathname, useRouter } from 'next/navigation'
import { useCallback, useMemo, useState, type ReactNode } from 'react'
import { AnimatePresence, motion } from 'framer-motion'

import { ToastProvider, useToast } from './_components/toast-context'
import { createClient } from '@/utils/supabaseBrowser'

const navigation = [
  { href: '/app/dashboard', label: 'Dashboard', hint: 'Studio overview' },
  { href: '/app/clients', label: 'Clients', hint: 'Relationships and health' },
  { href: '/app/projects', label: 'Projects', hint: 'Delivery and assets' },
  { href: '/app/kanban', label: 'Kanban', hint: 'Pipeline view' },
  { href: '/app/settings', label: 'Settings', hint: 'Workspace preferences' }
] satisfies ReadonlyArray<{ href: Route; label: string; hint: string }>

const quickFilters = ['All work', 'Live builds', 'Discovery', 'Ready for review']

type AppShellLayoutProps = {
  children: ReactNode
}

export default function AppShellLayout({ children }: AppShellLayoutProps) {
  const pathname = usePathname()
  const router = useRouter()
  const { pushToast } = useToast()
  const supabase = useMemo(() => createClient(), [])
  const [mobileOpen, setMobileOpen] = useState(false)
  const [signingOut, setSigningOut] = useState(false)

  const handleSignOut = useCallback(async () => {
    if (signingOut) {
      return
    }

    setSigningOut(true)

    try {
      const { error } = await supabase.auth.signOut()

      if (error) {
        pushToast({
          title: 'Unable to sign out',
          description: error.message,
          variant: 'error'
        })
        return
      }

      router.replace('/?signed_out=1')
    } catch (error) {
      console.error('Failed to sign out', error)
      pushToast({
        title: 'Unable to sign out',
        description: 'Something went wrong. Please try again.',
        variant: 'error'
      })
    } finally {
      setSigningOut(false)
    }
  }, [signingOut, supabase, pushToast, router])

  const activeLabel = useMemo(() => {
    const match = navigation.find((item) => pathname?.startsWith(item.href))
    return match?.label ?? 'Workspace'
  }, [pathname])

  const NavLinks = (
    <nav className="mt-10 space-y-1 text-sm">
      {navigation.map((item) => {
        const isActive = pathname === item.href || pathname?.startsWith(`${item.href}/`)
        return (
          <Link
            key={item.href}
            href={item.href}
            className={`group flex flex-col gap-1 rounded-xl px-4 py-3 transition ${
              isActive
                ? 'bg-white/10 text-white shadow-[0_0_30px_rgba(255,255,255,0.08)]'
                : 'text-white/70 hover:bg-white/5 hover:text-white'
            }`}
            onClick={() => setMobileOpen(false)}
          >
            <span className="text-sm font-semibold">{item.label}</span>
            <span className="text-[11px] uppercase tracking-wide text-white/40">{item.hint}</span>
          </Link>
        )
      })}
    </nav>
  )

  return (
    <ToastProvider>
      <div className="min-h-screen bg-base-950 text-white">
        <div className="flex min-h-screen">
          <aside className="hidden w-72 flex-col border-r border-white/10 bg-base-900/70 p-6 backdrop-blur lg:flex">
            <div className="mb-8">
              <span className="sr-only">TwinMind Studio Control Center</span>
              <svg
                className="h-8 w-auto"
                width="1154"
                height="273"
                viewBox="0 0 1154 273"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                aria-hidden="true"
              >
                <path d="M105.612 17.7438C114.722 23.3111 120.644 30.449 123.612 40.7438C124.105 44.8033 124.082 48.7923 124.003 52.8766C123.997 53.9945 123.991 55.1123 123.986 56.264C123.963 59.7994 123.913 63.3337 123.862 66.8688C123.842 69.2802 123.824 71.6917 123.807 74.1032C123.764 79.9837 123.697 85.8637 123.612 91.7438C122.674 91.8643 121.736 91.9847 120.769 92.1088C119.526 92.2758 118.283 92.4428 117.003 92.6149C115.162 92.8574 115.162 92.8574 113.285 93.1049C101.177 95.2111 92.1744 101.646 84.6747 111.244C81.1095 116.693 78.8144 123.202 79.6122 129.744C81.4392 131.993 81.4392 131.993 84.1122 131.994C86.7851 131.993 86.7851 131.993 88.6122 129.744C89.2403 127.862 89.8166 125.963 90.3622 124.056C93.1937 115.469 96.52 111.612 104.55 107.431C111.283 104.31 116.066 102.744 123.612 102.744C123.612 116.934 123.612 131.124 123.612 145.744C118.332 146.734 113.052 147.724 107.612 148.744C99.8051 151.548 93.2531 154.81 86.6122 159.744C85.6222 160.445 84.6322 161.146 83.6122 161.869C80.6423 164.389 78.5672 167.47 76.2997 170.619C69.4129 180.009 61.5562 185.096 50.6121 188.744C39.2358 189.849 28.7013 189.555 18.6121 183.744C17.519 183.146 16.4259 182.548 15.2996 181.931C7.65321 175.707 2.76133 168.407 0.612149 158.744C-0.214173 150.331 -1.0072 140.78 3.98715 133.572C9.38132 127.503 14.1554 123.182 22.4246 122.369C27.7958 122.531 32.3314 124.531 36.1903 128.275C39.9237 132.652 40.7508 135.083 40.7371 140.744C40.741 142.353 40.741 142.353 40.745 143.994C40.6121 146.744 40.6121 146.744 39.6121 148.744C39.4455 152.286 39.4455 152.286 39.6121 155.744C40.7375 157.1 40.7375 157.1 43.6746 156.806C45.1287 156.775 45.1287 156.775 46.6121 156.744C50.7417 150.818 51.1286 146.423 50.8621 139.306C50.8441 138.384 50.8261 137.462 50.8075 136.511C50.7607 134.254 50.6952 132 50.6121 129.744C51.4208 129.368 51.4208 129.368 52.2457 128.985C59.1835 125.662 64.2749 121.402 67.1473 113.974C68.25 108.683 68.1306 103.103 67.6122 97.7438C66.9522 96.7538 66.2922 95.7638 65.6122 94.7438C62.1472 95.2388 62.1471 95.2388 58.6121 95.7438C58.5735 97.1553 58.5735 97.1553 58.534 98.5954C57.9689 111.003 57.9689 111.003 53.6121 115.744C53.1623 116.277 52.7124 116.811 52.2489 117.361C50.1637 119.123 49.0039 119.177 46.2996 119.181C45.561 119.201 44.8224 119.22 44.0614 119.24C41.6121 118.744 41.6121 118.744 38.7996 116.845C35.2815 114.526 31.9745 113.575 27.9246 112.681C19.8245 110.879 19.8245 110.879 17.6121 107.744C14.722 99.0734 15.2325 87.2571 19.1121 79.0563C24.6789 69.7741 32.1238 62.962 42.6121 59.7438C50.2502 58.5886 59.3967 58.1958 66.1043 62.4821C70.9764 66.5589 73.2538 70.5697 74.6122 76.7438C77.5287 76.9106 77.5287 76.9106 80.6122 76.7438C83.0875 74.2684 82.8257 73.4577 82.9247 70.0563C83.3848 64.8285 84.5797 61.2392 88.6122 57.7438C90.9402 56.6233 93.2992 55.7055 95.7098 54.779C97.9733 53.8149 97.9733 53.8149 98.7997 50.6188C98.921 47.6129 98.921 47.6129 96.6122 45.7438C90.9432 45.0769 87.1001 46.3625 82.6122 49.7438C80.4895 51.6608 78.5657 53.6473 76.6122 55.7438C74.2476 54.8285 71.914 53.8888 69.6278 52.7907C64.05 50.1402 58.7045 48.7104 52.6121 47.7438C52.9774 38.0648 57.3323 30.5513 64.2372 23.8688C75.6837 14.3669 91.8441 10.5346 105.612 17.7438Z" fill="#A0D43D" />
                <path d="M143.612 103.744C145.831 103.715 148.05 103.694 150.268 103.677C151.504 103.665 152.74 103.653 154.013 103.64C167.566 104.031 180.975 111.194 190.557 120.494C197.494 128.09 200.088 136.407 201.362 146.494C202.968 156.938 208.5 167.209 216.35 174.318C216.87 174.685 217.389 175.053 217.925 175.431C218.436 175.806 218.948 176.182 219.475 176.568C226.379 180.367 232.864 181.349 240.612 181.931C241.578 182.013 242.543 182.095 243.538 182.179C245.895 182.378 248.253 182.566 250.612 182.744C251.156 192.352 250.011 200.857 243.862 208.619C237.701 215.107 230.225 218.734 221.3 219.119C212.869 218.925 206.454 215.531 200.405 209.748C193.66 202.209 193.241 194.99 192.978 185.287C192.619 174.181 190.287 165.689 182.807 157.255C179.906 155.257 178.063 155.316 174.612 155.744C172.394 157.56 172.394 157.56 172.28 160.127C172.691 163.364 173.639 164.338 175.925 166.619C182.532 173.24 182.979 179.585 183.05 188.494C183.382 200.328 185.211 209.895 193.612 218.744C201.354 225.935 210.187 229.071 220.612 229.744C221.199 240.303 217.95 249.289 211.612 257.744C204.435 265.595 195.448 271.265 184.706 272.017C172.45 272.404 162.937 271.167 153.612 262.431C150.042 258.545 147.457 254.685 145.612 249.744C145.272 248.837 144.931 247.929 144.58 246.995C143.6 243.703 143.365 241.129 143.372 237.707C143.369 236.521 143.366 235.335 143.363 234.113C143.37 232.825 143.378 231.538 143.385 230.211C143.386 228.831 143.385 227.451 143.384 226.071C143.384 222.335 143.395 218.6 143.409 214.865C143.422 210.958 143.423 207.05 143.425 203.142C143.432 195.747 143.448 188.353 143.468 180.958C143.49 172.537 143.501 164.117 143.511 155.696C143.532 138.378 143.568 121.061 143.612 103.744Z" fill="#F5F5F5" />
                <path d="M198.042 20.2164C207.226 26.7566 212.802 35.8445 215.3 46.7438C215.685 50.4413 215.676 54.0268 215.612 57.7438C216.52 57.785 217.427 57.8263 218.362 57.8688C226.831 59.0909 235.988 64.3045 241.612 70.7438C249.114 80.7983 253.039 90.0816 251.612 102.744C248.915 114.882 239.165 122.667 229.612 129.744C229.888 133.562 229.888 133.562 231.612 136.744C234.69 137.269 236.819 137.185 239.577 135.65C244.286 132.252 248.047 128.308 251.612 123.744C257.051 124.815 259.573 128.348 262.8 132.681C266.994 139.768 267.514 146.671 266.612 154.744C265.365 158.987 263.77 162.883 261.612 166.744C261.106 167.671 260.599 168.597 260.077 169.552C256.219 172.983 252.411 172.434 247.425 172.306C246.516 172.317 245.608 172.328 244.673 172.339C235.376 172.24 228.231 169.118 221.464 162.783C214.541 155.159 211.889 146.504 210.014 136.58C207.628 124.607 202.676 114.935 192.612 107.744C191.014 106.694 189.409 105.652 187.8 104.619C184.386 102.384 181.978 100.744 180.612 96.7438C180.707 91.4409 181.816 88.4401 185.612 84.7438C191.352 80.6859 195.046 80.334 201.925 81.1188C204.834 81.415 207.686 81.6203 210.612 81.7438C212.821 79.9159 212.821 79.9159 213.05 77.3063C212.885 74.5657 212.885 74.5657 210.479 73.1578C207.356 71.6176 204.738 71.0475 201.3 70.5563C199.697 70.3184 199.697 70.3184 198.061 70.0758C197.253 69.9662 196.445 69.8567 195.612 69.7438C195.526 69.1147 195.439 68.4857 195.35 67.8375C193.945 59.2748 191.363 53.4394 184.237 48.2438C180.259 45.7996 177.337 44.9724 172.612 45.7438C170.301 47.6046 170.301 47.6046 170.487 50.5563C171.954 54.7124 173.876 55.4459 177.604 57.5172C180.916 59.5406 182.9 62.3188 184.612 65.7438C184.999 69.0602 184.999 69.0602 184.612 72.7438C182.382 75.3336 182.382 75.3336 179.425 77.6813C174.616 81.729 171.607 85.2529 168.612 90.7438C167.612 91.7438 167.612 91.7438 165.295 91.8573C164.295 91.8521 163.295 91.8468 162.264 91.8414C161.185 91.8382 160.105 91.835 158.993 91.8317C157.857 91.8233 156.72 91.8149 155.55 91.8063C154.409 91.8018 153.269 91.7973 152.095 91.7926C149.267 91.7808 146.44 91.7643 143.612 91.7438C143.51 84.8246 143.44 77.9055 143.392 70.9857C143.372 68.6357 143.345 66.2858 143.31 63.9359C143.261 60.5423 143.239 57.1494 143.221 53.7555C143.201 52.7186 143.18 51.6817 143.159 50.6133C143.156 39.4133 146.398 30.9751 154.167 22.9117C166.558 11.9257 184.135 11.7873 198.042 20.2164Z" fill="#F5F5F5" />
                <path d="M122.612 156.744C124.631 158.763 123.78 162.899 123.789 165.669C123.796 166.5 123.802 167.331 123.809 168.187C123.829 170.954 123.841 173.72 123.85 176.486C123.855 177.431 123.859 178.376 123.863 179.35C123.884 184.362 123.898 189.374 123.907 194.385C123.918 199.545 123.953 204.703 123.993 209.862C124.019 213.841 124.027 217.82 124.031 221.799C124.035 223.699 124.047 225.599 124.066 227.499C124.197 241.748 123.485 252.804 113.124 263.576C104.781 270.777 96.0938 272.221 85.3856 272.029C80.3874 271.651 76.8527 270.322 72.6122 267.744C71.6016 267.187 70.5909 266.63 69.5497 266.056C62.4337 260.454 57.6367 254.664 55.6122 245.744C56.3134 245.525 57.0147 245.306 57.7372 245.08C67.1558 241.932 74.7425 237.695 79.6122 228.744C81.7392 223.376 82.5449 217.481 81.6122 211.744C80.3601 209.881 80.3601 209.881 78.6122 208.744C75.294 208.986 75.294 208.986 72.6122 210.744C72.3403 212.783 72.095 214.825 71.8622 216.869C70.9872 222.616 70.104 226.862 65.6122 230.744C58.5714 235.845 49.9592 235.803 41.6122 234.744C38.1903 233.531 35.5035 231.916 32.6122 229.744C31.7047 229.166 30.7972 228.589 29.8622 227.994C24.4821 222.614 20.8493 214.907 20.4169 207.314C20.4401 206.177 20.4633 205.04 20.4872 203.869C20.5052 202.716 20.5233 201.564 20.5419 200.377C20.5651 199.508 20.5883 198.639 20.6122 197.744C21.4846 197.905 22.3569 198.065 23.2557 198.231C28.4546 199.025 33.6116 198.969 38.8622 198.994C39.9437 199.014 41.0252 199.035 42.1395 199.056C55.9951 199.123 67.8593 194.692 77.8622 184.931C80.8857 181.755 83.6536 178.489 86.2997 174.994C94.6485 163.997 108.41 155.705 122.612 156.744Z" fill="#A0D43D" />
                <path d="M684 5.32361C695.22 5.32361 706.44 5.32361 718 5.32361C727.116 26.8162 736.229 48.311 745.132 69.8929C745.835 71.5943 746.539 73.2949 747.245 74.9948C748.225 77.3549 749.197 79.7177 750.168 82.0814C750.458 82.7762 750.747 83.471 751.046 84.1869C752.221 87.0693 753 89.1775 753 92.3236C753.66 92.3236 754.32 92.3236 755 92.3236C755.093 91.6751 755.187 91.0267 755.283 90.3585C756.244 86.29 757.839 82.6053 759.473 78.765C759.828 77.9197 760.183 77.0743 760.549 76.2033C761.716 73.429 762.889 70.6575 764.062 67.8861C764.871 65.9672 765.68 64.0481 766.488 62.1288C768.155 58.1711 769.825 54.2145 771.496 50.2587C773.915 44.531 776.318 38.7971 778.719 33.0619C779.815 30.4453 780.912 27.8289 782.009 25.2125C782.711 23.5376 783.412 21.8624 784.113 20.1869C785.085 17.8643 786.059 15.543 787.035 13.222C787.323 12.5325 787.611 11.8429 787.907 11.1324C789.886 6.43779 789.886 6.43779 791 5.32361C801.56 5.32361 812.12 5.32361 823 5.32361C823 45.2536 823 85.1836 823 126.324C815.41 126.324 807.82 126.324 800 126.324C799.67 99.9236 799.34 73.5236 799 46.3236C795.442 54.553 795.442 54.553 791.812 62.9486C790.343 66.3471 788.873 69.7455 787.402 73.1439C784.981 78.7405 782.562 84.3376 780.146 89.9365C778.993 92.6081 777.839 95.2793 776.684 97.9503C775.901 99.7625 775.12 101.576 774.339 103.389C771.008 111.091 767.541 118.715 764 126.324C757.4 126.324 750.8 126.324 744 126.324C731.826 99.5398 720.491 72.4104 709 45.3236C708.67 72.0536 708.34 98.7836 708 126.324C700.08 126.324 692.16 126.324 684 126.324C684 86.3936 684 46.4636 684 5.32361Z" fill="#F5F5F5" />
                <path d="M1041 2.32361C1048.59 2.32361 1056.18 2.32361 1064 2.32361C1064 43.2436 1064 84.1636 1064 126.324C1057.07 126.324 1050.14 126.324 1043 126.324C1042.51 122.859 1042.51 122.859 1042 119.324C1039.12 119.324 1038.16 120.772 1036 122.636C1026.97 129.715 1017.24 130.383 1006 129.324C995.655 127.035 986.985 121.07 981 112.324C979.422 109.401 978.117 106.451 977 103.324C976.462 101.844 976.462 101.844 975.914 100.335C974.405 94.8838 974.631 89.2496 974.625 83.6361C974.601 82.5282 974.576 81.4202 974.551 80.2787C974.507 67.8732 978.083 57.0401 986.313 47.6986C987.199 46.9149 988.086 46.1311 989 45.3236C989.552 44.8299 990.103 44.3362 990.672 43.8275C998.301 37.5068 1007.45 34.5662 1017.34 35.0072C1026.69 36.1192 1033.37 39.6986 1040 46.3236C1040.33 31.8036 1040.66 17.2836 1041 2.32361Z" fill="#F4F4F4" />
                <path d="M407 40.2964C414.59 40.2964 422.18 40.2964 430 40.2964C433.236 51.2426 436.447 62.1863 439.434 73.2027C439.738 74.3268 439.738 74.3268 440.049 75.4736C441.061 79.2104 442.066 82.9488 443.066 86.6888C443.437 88.0671 443.808 89.4455 444.18 90.8238C444.507 92.0483 444.834 93.2728 445.171 94.5345C445.728 97.1824 445.728 97.1824 447 98.2964C447.337 97.1079 447.675 95.9194 448.022 94.6949C449.297 90.2063 450.574 85.7186 451.852 81.231C452.401 79.3035 452.949 77.3758 453.496 75.4478C456.837 63.6755 460.293 51.9593 464 40.2964C471.26 40.2964 478.52 40.2964 486 40.2964C486.666 42.6122 486.666 42.6122 487.345 44.9747C488.995 50.7114 490.647 56.4476 492.299 62.1837C493.013 64.6646 493.727 67.1458 494.44 69.627C495.467 73.1969 496.495 76.7662 497.523 80.3355C498 81.9952 498 81.9952 498.486 83.6884C499.901 88.5916 501.324 93.4745 503 98.2964C504.477 93.0908 505.952 87.8845 507.425 82.6776C507.924 80.9157 508.423 79.1539 508.923 77.3924C512.423 65.0613 515.77 52.7012 519 40.2964C526.59 40.2964 534.18 40.2964 542 40.2964C537.199 57.3793 532.057 74.3459 526.839 91.3044C525.959 94.1648 525.081 97.0257 524.203 99.8867C523.15 103.318 522.097 106.749 521.043 110.179C520.844 110.826 520.646 111.473 520.441 112.139C519.882 113.959 519.322 115.778 518.762 117.598C518.287 119.145 518.287 119.145 517.801 120.723C517.221 122.587 516.617 124.444 516 126.296C508.08 126.296 500.16 126.296 492 126.296C485.459 107.528 480.206 88.4672 475 69.2964C472.722 75.9571 470.665 82.6684 468.68 89.4214C468.056 91.5295 467.432 93.6376 466.809 95.7457C465.835 99.0417 464.863 102.338 463.892 105.635C462.949 108.835 462.002 112.035 461.055 115.234C460.763 116.229 460.471 117.223 460.171 118.248C459.765 119.616 459.765 119.616 459.351 121.011C459.114 121.817 458.876 122.622 458.632 123.452C458 125.296 458 125.296 457 126.296C455.219 126.384 453.435 126.403 451.652 126.394C450.573 126.391 449.493 126.388 448.381 126.384C447.245 126.376 446.108 126.368 444.938 126.359C443.797 126.354 442.657 126.35 441.482 126.345C438.655 126.333 435.827 126.317 433 126.296C417.397 76.7815 417.397 76.7815 411 55.7339C410.789 55.0436 410.578 54.3532 410.361 53.6419C409.779 51.7347 409.202 49.8262 408.625 47.9175C408.308 46.8701 407.991 45.8227 407.664 44.7435C407 42.2964 407 42.2964 407 40.2964Z" fill="#A0D43C" />
                <path d="M949.188 40.0737C955.338 44.9942 959.805 50.6794 962 58.3237C962.531 63.5813 962.468 68.8027 962.391 74.0776C962.383 75.5893 962.377 77.101 962.373 78.6127C962.358 82.5634 962.319 86.5135 962.275 90.4639C962.234 94.5063 962.215 98.5487 962.195 102.591C962.153 110.502 962.082 118.413 962 126.324C954.74 126.324 947.48 126.324 940 126.324C939.991 124.669 939.981 123.015 939.972 121.31C939.932 115.152 939.866 108.995 939.792 102.837C939.762 100.176 939.743 97.5148 939.729 94.853C939.708 91.0199 939.661 87.1877 939.609 83.3549C939.608 82.1713 939.607 80.9877 939.606 79.7681C939.463 71.6555 938.541 65.7764 932.5 59.8862C927.475 56.7453 921.786 56.5678 916 57.3237C910.823 59.294 907.583 62.1348 904.868 67.0158C903.014 71.9452 903.396 77.2753 903.391 82.476C903.374 83.7313 903.358 84.9866 903.341 86.2799C903.3 89.5959 903.277 92.9112 903.262 96.2274C903.242 99.6197 903.2 103.012 903.16 106.404C903.086 113.044 903.037 119.683 903 126.324C895.41 126.324 887.82 126.324 880 126.324C880 97.2837 880 68.2437 880 38.3237C887.59 38.3237 895.18 38.3237 903 38.3237C903 41.9537 903 45.5837 903 49.3237C904.074 48.3069 904.074 48.3069 905.023 46.8706C915.404 33.0696 934.968 32.2669 949.188 40.0737Z" fill="#F4F4F5" />
                <path d="M655.25 42.0465C661.667 47.2966 666.468 53.2461 667.361 61.7198C667.354 62.9123 667.347 64.1047 667.341 65.3333C667.341 66.3297 667.341 66.3297 667.342 67.3463C667.34 69.5162 667.317 71.6853 667.293 73.8551C667.287 75.3696 667.283 76.8842 667.28 78.3988C667.269 82.3658 667.239 86.3325 667.206 90.2993C667.175 94.355 667.162 98.4107 667.146 102.466C667.114 110.41 667.062 118.353 667 126.296C660.07 126.296 653.14 126.296 646 126.296C645.985 124.733 645.971 123.169 645.956 121.558C645.898 115.736 645.82 109.914 645.738 104.092C645.704 101.576 645.676 99.06 645.654 96.544C645.62 92.9195 645.568 89.2957 645.512 85.6715C645.505 84.5535 645.499 83.4354 645.492 82.2835C645.356 75.0009 644.792 68.8332 640.125 62.9215C634.85 58.8879 629.464 58.5087 623 59.2965C618.494 60.6449 616.386 62.6953 613.843 66.6519C611.178 72.2819 611.397 77.9849 611.391 84.109C611.374 85.3184 611.358 86.5279 611.341 87.774C611.292 91.6149 611.271 95.4554 611.25 99.2965C611.222 101.91 611.192 104.523 611.16 107.136C611.086 113.523 611.037 119.909 611 126.296C603.74 126.296 596.48 126.296 589 126.296C589 97.9165 589 69.5365 589 40.2965C595.93 40.2965 602.86 40.2965 610 40.2965C610.33 43.5965 610.66 46.8965 611 50.2965C611.577 49.4302 612.155 48.564 612.75 47.6715C623.222 35.0026 641.832 34.8216 655.25 42.0465Z" fill="#9FD43C" />
                <path d="M1139 41.1987C1144.64 45.345 1147.63 49.6973 1150 56.3237C1150.05 57.9896 1150.06 59.658 1150 61.3237C1146.73 61.4688 1143.46 61.5577 1140.19 61.6362C1139.26 61.6781 1138.33 61.72 1137.37 61.7631C1134.82 61.8091 1132.5 61.8043 1130 61.3237C1128.01 58.9174 1128.01 58.9174 1127 56.3237C1121.48 52.111 1114.62 52.6846 1108 53.3237C1104.44 54.6515 1102.64 55.6788 1100 58.3237C1099.43 62.9172 1099.43 62.9172 1101.24 66.9499C1108.09 72.2997 1119.85 72.7471 1128.17 74.1655C1136.41 75.7405 1142.35 78.7719 1148.38 84.6362C1152.93 92.1725 1154.29 100.107 1152.5 108.746C1150.51 115.507 1147.13 120.208 1141.12 124.011C1126.92 131.315 1109.59 130.957 1094.58 126.585C1087.03 123.925 1081.89 119.299 1078 112.324C1076.46 108.594 1076 106.394 1076 102.324C1079.42 102.149 1082.83 102.043 1086.25 101.949C1087.22 101.898 1088.19 101.848 1089.18 101.796C1091.91 101.74 1094.33 101.754 1097 102.324C1099.49 105.23 1099.49 105.23 1101 108.324C1107.35 112.465 1114.64 111.988 1122 111.324C1125 110.527 1127.75 109.572 1130 107.324C1130.07 105.804 1130.08 104.282 1130.06 102.761C1130.05 101.935 1130.04 101.109 1130.04 100.257C1130.02 99.6192 1130.01 98.9811 1130 98.3237C1122.96 94.8811 1115.65 93.7201 1107.98 92.3061C1099.81 90.7145 1092 88.6442 1085.62 83.0112C1085 82.4788 1084.37 81.9464 1083.73 81.3979C1079.26 76.0355 1078.47 70.6224 1078.56 63.8862C1078.57 63.1348 1078.58 62.3834 1078.59 61.6093C1078.84 53.6682 1080.89 49.1452 1086.56 43.5737C1091.19 39.7735 1096.3 37.9688 1102 36.3237C1102.61 36.1303 1103.23 35.9369 1103.86 35.7377C1115.44 33.4986 1129 34.888 1139 41.1987Z" fill="#F4F4F4" />
                <path d="M322 11.2964C350.05 11.2964 378.1 11.2964 407 11.2964C407 17.8964 407 24.4964 407 31.2964C396.77 31.2964 386.54 31.2964 376 31.2964C376 62.6464 376 93.9964 376 126.296C368.74 126.296 361.48 126.296 354 126.296C354 94.9464 354 63.5964 354 31.2964C343.44 31.2964 332.88 31.2964 322 31.2964C322 24.6964 322 18.0964 322 11.2964Z" fill="#A0D53C" />
                <path d="M842 38.3236C849.26 38.3236 856.52 38.3236 864 38.3236C864 67.3636 864 96.4036 864 126.324C856.74 126.324 849.48 126.324 842 126.324C842 97.2836 842 68.2436 842 38.3236Z" fill="#F6F5F6" />
                <path d="M1032 59.3237C1037.2 63.7775 1041.27 69.4126 1042.3 76.3334C1042.44 78.4652 1042.47 80.5628 1042.44 82.6987C1042.43 83.4467 1042.42 84.1948 1042.41 84.9655C1042.21 91.7511 1041.07 97.0475 1036.32 102.121C1029.92 107.896 1025.1 108.779 1016.49 108.636C1010.18 108.071 1006.7 105.945 1002.19 101.636C997.163 94.028 995.964 86.3582 997 77.3237C998.573 70.7535 1000.61 65.639 1006 61.3237C1006.64 60.7668 1007.28 60.2099 1007.94 59.6362C1015.46 54.8474 1024.27 55.2266 1032 59.3237Z" fill="#1E1D1E" />
                <path d="M553 40.2964C559.93 40.2964 566.86 40.2964 574 40.2964C574 68.6764 574 97.0564 574 126.296C567.07 126.296 560.14 126.296 553 126.296C553 97.9164 553 69.5364 553 40.2964Z" fill="#A1D63C" />
                <path d="M859.75 1.44863C863.705 4.74488 865.766 7.68364 866.5 12.8236C865.802 17.7069 863.822 20.6957 860.164 23.9643C856.337 26.3684 852.355 26.0586 848 25.3236C844.601 23.6379 842.565 21.2332 840.562 18.0111C839.498 12.9274 840.035 8.85402 842.812 4.44864C847.719 -0.317237 853.404 -1.14732 859.75 1.44863Z" fill="#F4F4F4" />
                <path d="M571.313 5.10893C574.114 7.38913 575.822 8.93487 576.301 12.6011C576.341 21.4779 576.341 21.4779 573 25.2964C568.789 27.8143 564.795 28.1344 560 27.2964C556.929 25.5827 554.595 23.4874 553 20.2964C552.423 15.5655 552.566 12.1493 554.75 7.85893C559.479 2.47324 564.858 1.57703 571.313 5.10893Z" fill="#A2D63D" />
                <path d="M612.806 158C619.14 158 625.474 158 632 158C632 195.071 632 232.142 632 270.336C625.666 270.336 619.332 270.336 612.806 270.336C612.354 267.624 611.902 264.911 611.435 262.117C609.315 263.727 609.315 263.727 607.151 265.37C599.449 270.815 592.107 272.812 582.645 271.706C573.632 269.779 566.715 264.906 560.71 258.007C552.754 245.216 550.988 233.155 552.484 218.278C556.045 206.556 562.929 197.737 573.048 190.879C581.539 186.651 592.231 186.359 601.228 189.274C605.143 191.194 608.348 193.274 611.435 196.359C611.888 183.7 612.34 171.042 612.806 158Z" fill="#9FA1A0" />
                <path d="M733.192 190.863C742.254 196.336 749.28 204.547 753.219 214.464C755.963 226.001 755.954 239.405 750.207 249.947C749.708 250.767 749.208 251.587 748.693 252.432C747.966 253.872 747.24 255.311 746.491 256.794C740.196 264.32 729.557 270.736 719.745 271.999C707.872 272.058 698.222 269.421 688.865 261.823C679.87 252.704 675.712 241.416 675 228.745C675.377 216.449 680.372 206.321 688.823 197.634C701.139 186.495 717.81 183.882 733.192 190.863Z" fill="#9FA1A0" />
                <path d="M387.713 163.512C397.661 170.174 403.998 177.021 408.164 188.403C408.164 189.748 408.164 191.094 408.164 192.48C400.942 192.48 393.721 192.48 386.281 192.48C385.547 190.994 384.814 189.509 384.058 187.978C381.027 182.811 378.488 180.731 372.604 178.89C363.219 177.657 357.025 178.812 349.354 184.326C347.744 187.524 347.759 189.6 347.729 193.159C347.7 194.778 347.7 194.778 347.671 196.429C347.717 199.574 347.717 199.574 350.721 201.992C353.89 202.742 353.89 202.742 357.592 203.16C358.981 203.354 360.371 203.549 361.803 203.749C363.28 203.954 364.757 204.159 366.279 204.371C380.423 206.531 394.215 208.663 404.232 219.829C409.656 228.092 410.795 234.245 409.531 244.12C406.109 254.731 400.12 261.962 390.404 267.377C382.52 271.128 375.913 272.169 367.219 271.978C365.417 271.954 365.417 271.954 363.58 271.929C354.785 271.661 347.339 270.627 339.78 265.863C338.907 265.318 338.034 264.774 337.135 264.212C329.822 258.821 325.432 251.029 322 242.761C322 240.967 322 239.173 322 237.325C325.537 237.105 329.059 236.943 332.6 236.816C333.597 236.747 334.595 236.679 335.623 236.609C338.562 236.529 338.562 236.529 343.883 237.325C347.11 241.237 347.11 241.237 349.354 245.479C356.55 252.093 362.437 252.665 371.952 252.582C377.968 252.035 382.079 249.654 386.281 245.479C386.873 242.312 386.873 242.312 386.879 238.769C386.934 237.58 386.989 236.39 387.045 235.165C386.599 231.62 386.599 231.62 383.28 229.733C379.343 227.763 376.327 227.005 371.979 226.416C370.569 226.209 369.16 226.001 367.708 225.787C364.777 225.384 361.846 224.984 358.914 224.588C348.982 223.118 340.194 221.378 332.861 214.175C331.928 212.811 331.928 212.811 330.975 211.42C330.328 210.507 329.681 209.595 329.015 208.654C324.408 200.942 325.138 191.597 326.103 182.967C329.754 173.359 337.489 167.009 346.618 162.583C359.109 158.298 375.759 157.006 387.713 163.512Z" fill="#9FA1A0" />
                <path d="M471.118 190C477.415 190 483.713 190 490.201 190C490.214 191.521 490.227 193.041 490.24 194.608C490.294 200.273 490.384 205.937 490.484 211.601C490.523 214.048 490.552 216.496 490.571 218.943C490.6 222.47 490.664 225.995 490.734 229.522C490.736 230.609 490.737 231.695 490.739 232.815C490.925 239.945 492.284 244.092 497.017 249.755C502.057 252.265 507.874 251.759 513.374 251.113C517.374 248.673 519.47 247.115 521.553 242.964C521.767 239.006 521.906 235.075 521.984 231.113C522.013 229.942 522.041 228.77 522.07 227.562C522.16 223.813 522.24 220.063 522.32 216.312C522.379 213.773 522.438 211.234 522.498 208.695C522.644 202.463 522.782 196.232 522.916 190C529.214 190 535.512 190 542 190C542 215.993 542 241.987 542 268.768C535.702 268.768 529.405 268.768 522.916 268.768C522.242 264.734 522.242 264.734 521.553 260.619C520.861 261.176 520.169 261.733 519.455 262.306C511.132 268.797 504.095 272.319 493.338 271.977C485.366 270.723 479.651 265.932 474.914 259.601C468.041 247.8 470.28 232.87 470.606 219.708C470.648 216.825 470.685 213.943 470.718 211.061C470.808 204.039 470.949 197.02 471.118 190Z" fill="#9FA1A0" />
                <path d="M424.316 168C430.638 168 436.96 168 443.474 168C443.474 175.223 443.474 182.446 443.474 189.888C450.247 189.888 457.021 189.888 464 189.888C464 195.756 464 201.625 464 207.672C457.226 207.672 450.453 207.672 443.474 207.672C443.925 221.215 444.377 234.758 444.842 248.711C449.803 251.191 452.194 251.883 457.5 252.302C460.718 252.556 460.718 252.556 464 252.815C464 258.684 464 264.552 464 270.599C439.677 271.521 439.677 271.521 429.961 263.075C424.572 256.737 423.938 252.724 424.049 244.677C424.052 243.62 424.056 242.563 424.06 241.474C424.076 238.101 424.11 234.728 424.145 231.355C424.158 229.067 424.171 226.779 424.182 224.491C424.212 218.884 424.26 213.278 424.316 207.672C420.252 207.672 416.187 207.672 412 207.672C412 201.803 412 195.934 412 189.888C416.064 189.888 420.128 189.888 424.316 189.888C424.316 182.665 424.316 175.442 424.316 168Z" fill="#9FA1A0" />
                <path d="M647 190C653.27 190 659.54 190 666 190C666 216.4 666 242.8 666 270C659.73 270 653.46 270 647 270C647 243.6 647 217.2 647 190Z" fill="#9FA1A0" />
                <path d="M598.764 206.371C605.814 210.025 610.058 213.857 612.581 221.285C613.256 230.121 613.802 238.167 608.436 245.69C604.492 250.165 601.745 252.066 595.677 252.888C589.044 253.222 584.685 253.058 579.422 248.826C574.542 244.371 572.758 239.788 572.049 233.324C571.868 218.188 571.868 218.188 578.04 211.794C584.206 206.476 590.681 205.274 598.764 206.371Z" fill="black" />
                <path d="M721.766 207.549C728.294 210.201 732.44 214.956 735.584 221.142C736.59 230.774 736.138 239.072 730.057 246.968C725.601 250.953 722.182 252.721 716.239 253C709.002 252.592 704.161 250.178 699.226 244.929C694.234 237.655 694.689 229.627 695.512 221.142C697.844 216.384 697.844 216.384 701.039 212.986C702.493 211.388 702.493 211.388 703.976 209.758C709.85 206.491 715.169 206.671 721.766 207.549Z" fill="black" />
                <path d="M661.311 156.954C664.545 159.127 664.545 159.127 666.618 162.303C667.397 167.698 667.091 170.692 664.711 175.594C660.364 179.121 657.617 179.053 652.185 178.979C648.703 178.203 647.517 177.201 645.392 174.34C644.433 170.347 643.787 167.629 644.065 163.641C648.954 155.653 652.4 154.94 661.311 156.954Z" fill="#9FA1A0" />
              </svg>
            </div>
            <div className="rounded-2xl border border-white/10 bg-base-900/60 p-4">
              <p className="text-xs text-white/50">Quick filters</p>
              <div className="mt-3 flex flex-wrap gap-2">
                {quickFilters.map((filter) => (
                  <button
                    key={filter}
                    type="button"
                    className="rounded-full bg-white/5 px-3 py-1 text-[11px] font-medium uppercase tracking-wide text-white/60 transition hover:bg-white/10 hover:text-white"
                  >
                    {filter}
                  </button>
                ))}
              </div>
            </div>
            {NavLinks}
            <div className="mt-auto pt-8">
              <div className="rounded-2xl border border-white/10 bg-gradient-to-br from-white/10 to-white/5 p-4 text-xs text-white/70">
                <p className="font-semibold text-white">Need a hand?</p>
                <p className="mt-2 leading-relaxed">
                  Explore the playbooks, service templates, and latest project retros in the knowledge base.
                </p>
                <Link
                  href="/portal"
                  className="mt-3 inline-flex text-[11px] font-semibold uppercase tracking-wide text-limeglow-300 underline-offset-4 hover:text-limeglow-100 hover:underline"
                >
                  Open knowledge base →
                </Link>
              </div>
            </div>
          </aside>

          <div className="flex flex-1 flex-col">
            <header className="border-b border-white/10 bg-base-900/40 px-6 py-5 backdrop-blur">
              <div className="flex items-center gap-4">
                <button
                  type="button"
                  onClick={() => setMobileOpen((value) => !value)}
                  className="inline-flex h-10 w-10 items-center justify-center rounded-full border border-white/10 bg-base-900/60 text-white/70 transition hover:border-white/20 hover:text-white lg:hidden"
                  aria-label="Toggle navigation"
                >
                  <span className="sr-only">Toggle navigation</span>
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.6" className="h-5 w-5">
                    <path strokeLinecap="round" strokeLinejoin="round" d="M4 6h16M4 12h16M4 18h16" />
                  </svg>
                </button>
                <div className="hidden lg:block">
                  <p className="text-xs uppercase tracking-[0.2em] text-white/40">Currently viewing</p>
                  <p className="text-lg font-semibold text-white">{activeLabel}</p>
                </div>
                <div className="ml-auto hidden w-full max-w-md items-center gap-3 rounded-full border border-white/10 bg-base-900/60 px-4 py-2 text-sm text-white/60 shadow-sm shadow-base-900/30 focus-within:border-white/30 focus-within:text-white/80 md:flex">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="h-4 w-4">
                    <path strokeLinecap="round" strokeLinejoin="round" d="m21 21-4.35-4.35M11 19a8 8 0 1 1 0-16 8 8 0 0 1 0 16Z" />
                  </svg>
                  <input
                    type="search"
                    placeholder="Search clients, projects, or assets"
                    className="w-full bg-transparent text-sm text-white/80 placeholder:text-white/40 focus:outline-none"
                  />
                </div>
                <button
                  type="button"
                  className="hidden h-10 w-10 items-center justify-center rounded-full border border-white/10 bg-base-900/60 text-white/70 transition hover:border-white/20 hover:text-white md:inline-flex"
                  aria-label="Notifications"
                >
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.6" className="h-5 w-5">
                    <path strokeLinecap="round" strokeLinejoin="round" d="M15 18.5a3 3 0 0 1-6 0M5 9a7 7 0 1 1 14 0c0 5 1 6 1 6H4s1-1 1-6Z" />
                  </svg>
                </button>
                <details className="relative ml-2 hidden md:block">
                  <summary className="flex cursor-pointer list-none items-center gap-3 rounded-full border border-white/10 bg-base-900/60 px-3 py-1.5 text-left text-sm text-white/80 transition hover:border-white/20 hover:text-white">
                    <span className="flex h-8 w-8 items-center justify-center rounded-full bg-gradient-to-br from-limeglow-500 via-limeglow-600 to-limeglow-700 text-sm font-semibold text-base-900">
                      EL
                    </span>
                    <span className="hidden text-xs uppercase tracking-wide text-white/60 lg:block">Evelyn Lopez</span>
                  </summary>
                  <div className="absolute right-0 mt-2 w-48 overflow-hidden rounded-xl border border-white/10 bg-base-900/80 p-2 shadow-lg">
                    <Link
                      href="/app/settings"
                      className="block rounded-lg px-3 py-2 text-sm text-white/70 transition hover:bg-white/10 hover:text-white"
                    >
                      View profile
                    </Link>
                    <button
                      type="button"
                      onClick={handleSignOut}
                      disabled={signingOut}
                      className="block w-full rounded-lg px-3 py-2 text-left text-sm text-rose-300 transition hover:bg-white/10 hover:text-rose-200 disabled:cursor-not-allowed disabled:opacity-60"
                    >
                      Sign out
                    </button>
                  </div>
                </details>
              </div>
              <div className="mt-4 flex flex-col gap-3 md:hidden">
                <div className="flex w-full items-center gap-3 rounded-full border border-white/10 bg-base-900/60 px-4 py-2 text-sm text-white/60 shadow-sm focus-within:border-white/30 focus-within:text-white/80">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="h-4 w-4">
                    <path strokeLinecap="round" strokeLinejoin="round" d="m21 21-4.35-4.35M11 19a8 8 0 1 1 0-16 8 8 0 0 1 0 16Z" />
                  </svg>
                  <input
                    type="search"
                    placeholder="Search workspace"
                    className="w-full bg-transparent text-sm text-white/80 placeholder:text-white/40 focus:outline-none"
                  />
                </div>
                <div className="flex items-center justify-between text-xs text-white/50">
                  <span>Team workspace</span>
                  <span className="font-medium text-white/70">TwinMind Studio</span>
                </div>
              </div>
            </header>
            <main className="flex-1 space-y-6 bg-base-900/20 p-6">
              {children}
            </main>
          </div>
        </div>

        <AnimatePresence>
          {mobileOpen ? (
            <motion.div
              key="mobile-nav"
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              exit={{ opacity: 0 }}
              className="fixed inset-0 z-50 bg-black/60 backdrop-blur lg:hidden"
              onClick={() => setMobileOpen(false)}
            >
              <motion.aside
                initial={{ x: -40, opacity: 0 }}
                animate={{ x: 0, opacity: 1 }}
                exit={{ x: -40, opacity: 0 }}
                transition={{ duration: 0.2, ease: 'easeOut' }}
                className="absolute left-4 top-8 bottom-8 right-20 rounded-3xl border border-white/10 bg-base-900/90 p-6 shadow-2xl"
                onClick={(event) => event.stopPropagation()}
              >
                <div className="flex items-center justify-between">
                  <div>
                    <p className="text-xs uppercase tracking-[0.3em] text-white/40">TwinMind Studio</p>
                    <p className="text-sm font-semibold text-white">Menu</p>
                  </div>
                  <button
                    type="button"
                    onClick={() => setMobileOpen(false)}
                    className="inline-flex h-9 w-9 items-center justify-center rounded-full border border-white/10 text-white/70 transition hover:border-white/20 hover:text-white"
                    aria-label="Close navigation"
                  >
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.6" className="h-5 w-5">
                      <path strokeLinecap="round" strokeLinejoin="round" d="M6 18 18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>
                {NavLinks}
              </motion.aside>
            </motion.div>
          ) : null}
        </AnimatePresence>
      </div>
    </ToastProvider>
  )
}
